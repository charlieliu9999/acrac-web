# ACRAC 优化任务清单（按优先级 1-4）

说明：每个任务包含 描述、预期交付物、验收标准、时间估算、对齐目标（业务/技术KPI）、里程碑。

## 任务分组与总体目标对齐
- 业务目标 G1：提升临床可用性与推荐一致性
- 业务目标 G2：稳定可控的多模型能力与灰度发布
- 技术指标 K1：RAGAS answer_relevancy ≥ 0.5、context_recall ≥ 0.4（同数据集）
- 技术指标 K2：主路径 P90 < 3s、缓存命中率 ≥ 60%
- 技术指标 K3：模型切换 0 宕机、监控指标可视
- 技术指标 K4：API 端点 ≤45（Round1），后续 ~30（Round2）

---
## 优先级1：模型配置系统全面重构（M1-M2）

- [ ] T1.1 系统状态 API 与前端对接（M1）
  - 描述：新增 GET /api/v1/admin/system/status，返回 API/DB/Embedding/LLM 状态；前端 SystemStatusCard 展示绿/红与错误原因
  - 交付物：后端接口+单测；前端页面与交互；接口文档
  - 验收：所有 Provider 状态可查询；错误原因可解释；接口稳定 99.9%
  - 时间：2 天
  - 对齐：G2、K3

- [ ] T1.2 Provider 连通性测试 API（M1）
  - 描述：POST /api/v1/admin/models/providers/test，给定配置完成鉴权与连通测试，返回耗时/错误信息
  - 交付物：接口+单测；前端 ProviderTabs 上“测试”功能
  - 验收：测试稳定、异常清晰；支持 SiliconFlow、Ollama、OpenAI、DashScope 至少两种
  - 时间：2 天
  - 对齐：G2、K3

- [ ] T1.3 维度兼容性检查 API（只读）（M1）
  - 描述：GET /api/v1/admin/models/compatibility/check，对比当前库表向量维度与目标 embedding 维度
  - 交付物：接口+文档；前端风险提示
  - 验收：能识别不兼容并输出迁移建议（不执行迁移）
  - 时间：1 天
  - 对齐：G2、K3

- [ ] T1.4 Model Registry 与热更新（M2）
  - 描述：新增 /registry/apply、/registry/active；引入运行时容器（版本+读写锁），10% 灰度
  - 交付物：接口+单测；前端“发布/回退”操作；审计日志
  - 验收：切换 0 宕机；错误率/延迟阈值触发自动回退；Prometheus 曝光指标
  - 时间：3 天
  - 对齐：G2、K3

- [ ] T1.5 准入测试基线与 Prometheus 指标（M2）
  - 描述：连通/时延/基础准确性小测集；/metrics 暴露 provider/model 维度
  - 交付物：测试脚本、最小金标集（10 条）、指标文档
  - 验收：未通过准入测试不可发布；指标在看板可见
  - 时间：2 天
  - 对齐：G1、G2、K3

---
## 优先级2：RAG+LLM 推理流程优化（M3-M4）

- [ ] T2.1 并行化骨架与 L1 缓存（M3）
  - 描述：OptimizedInferenceEngine；向量化/检索/预热并发；L1 LRU 缓存；特性开关
  - 交付物：实现+单测；开关配置；对比报告
  - 验收：固定 50 样本，P90 < 3.5s；准确性不降；可一键回退
  - 时间：3 天
  - 对齐：G1、K2

- [ ] T2.2 向量索引升级与参数调优（M4）
  - 描述：HNSW 或 IVF 索引上线与 ef/probes 调优；explain analyze 验证
  - 交付物：迁移脚本与只读演练；调参说明；对比数据
  - 验收：P90 < 3.0s；索引稳定、查询可解释
  - 时间：2 天
  - 对齐：G1、K2

- [ ] T2.3 L2 Redis 缓存与 /metrics（M4）
  - 描述：对重复查询与重排结果加 Redis 缓存；Prometheus 指标补齐
  - 交付物：实现+dashboard 面板草图
  - 验收：缓存命中率 ≥ 60%；错误率不升
  - 时间：2 天
  - 对齐：G1、K2

- [ ] T2.4 Prompt/上下文精摘输出（M3-M4）
  - 描述：构建证据句精摘与严格 JSON 输出；减少冗长影响推理质量
  - 交付物：实现+示例
  - 验收：RAGAS faithfulness 稳定；人工抽检可读性提升
  - 时间：2 天
  - 对齐：G1、K1

---
## 优先级3：RAGAS 评测系统通用化（M5-M6）

- [ ] T3.1 评测模板与裁判引擎（M5）
  - 描述：医疗领域专用 Prompt 模板；LLM-as-Judge；JSON Schema 校验
  - 交付物：模板库、引擎实现、Schema 校验、文档
  - 验收：JSON 合法率 > 99%；10 条典型场景给出可解释证据
  - 时间：4 天
  - 对齐：G1、K1

- [ ] T3.2 小型金标集与回归脚本（M5）
  - 描述：20–50 条；回归与对比脚本
  - 交付物：数据集、脚本、基线报告
  - 验收：可重复、可追溯
  - 时间：2 天
  - 对齐：G1、K1

- [ ] T3.3 批量评测与可视化（M6）
  - 描述：批处理评测引擎；前端可视化分布/趋势/TopN
  - 交付物：后端批量任务接口；前端图表；HTML 报告
  - 验收：1000+ 样本稳定完成；报告可下载
  - 时间：4 天
  - 对齐：G1、K1

---
## 优先级4：API 架构优化与治理（M7-M8）

- [ ] T4.1 使用率统计与收敛清单 v1（M7）
  - 描述：采集路由使用；生成保留/合并/废弃清单；兼容层与文档
  - 交付物：使用率报告、迁移清单、兼容实现、Swagger 更新
  - 验收：端点 ≤ 45；0 兼容事故
  - 时间：3 天
  - 对齐：G2、K4

- [ ] T4.2 统一响应格式与错误码（M8）
  - 描述：统一 code/message/data + traceId；错误码字典与拦截器
  - 交付物：后端适配、中间件；前端适配；文档
  - 验收：覆盖率 ≥ 95%；错误语义一致
  - 时间：3 天
  - 对齐：G2、K4

- [ ] T4.3 第二轮收敛提案与落地（M8）
  - 描述：目标 ~30 端点；清理冗余；完成迁移
  - 交付物：收敛报告；代码变更；文档
  - 验收：~30 端点；0 线上事故
  - 时间：3 天
  - 对齐：G2、K4

---
## 进度跟踪与对齐机制（如何确保每个任务服务于目标）

- Tracking 工具：
  - GitHub Projects 看板（Backlog → In Progress → Review → Done）
  - 每个任务创建 Issue，标签：Priority(P1–P4)、Milestone(M1–M8)、Goal(G1/G2)、KPI(K1–K4)
  - PR 模板要求：
    - 关联任务与里程碑
    - 验收证据（截图/报告/日志）
    - 回滚方案与影响评估

- KPI 仪表盘：
  - Prometheus/Grafana：P50/P90/P99、缓存命中率、错误率、模型调用时延/成功率
  - 评测看板：RAGAS 四项分布与趋势；LLM-as-Judge 解释样例

- 里程碑成功标准（M1–M8）：
  - M1：状态/连通/兼容检查完成；结果可视
  - M2：Registry+热更新+准入+指标；切换 0 宕机
  - M3：P90 < 3.5s；可回退
  - M4：P90 < 3.0s；命中率 ≥ 60%
  - M5：裁判评测 JSON 合法率 > 99%
  - M6：1000+ 批评测稳定输出
  - M7：端点 ≤ 45；文档同步
  - M8：~30 端点；统一响应规范

---
## 附：示例任务卡片模板（用于 Issue）

- 标题：T1.1 系统状态 API 与前端对接（M1）
- 描述：新增 GET /api/v1/admin/system/status；前端展示绿/红与错误原因
- 交付物：接口/单测/文档/前端页面
- 验收：各 Provider 状态准确；错误原因可解释；CI 通过
- 时间：2 天
- 对齐：G2、K3；KPI：K3
- 里程碑：M1

